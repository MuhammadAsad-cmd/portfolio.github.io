<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- CSS Link -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <!-- font awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">


    <title>Manage All Cards</title>

</head>
<style>
    li a {
        border-radius: 10px;

    }

    li .nav-link:hover {
        background-color: rgb(120, 175, 247);
        border-radius: 10px;
        color: white;
    }

    .card:hover {

        box-shadow: rgba(0, 0, 0, 0.25) 0px 0.0625em 0.0625em, rgba(0, 0, 0, 0.25) 0px 0.125em 0.5em, rgba(255, 255, 255, 0.1) 0px 0px 0px 1px inset;
    }

    @media only screen and (min-width: 390px) {

        .favourite,
        .delete-Card {
            margin-top: 20px;
        }
    }
</style>

<body class="bg-light">

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white" aria-label="Third navbar example" id="tbalerw">
        <div class="container-fluid">

            <button class="navbar-toggler collapsed mb-4" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarsExample03" aria-controls="navbarsExample03" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="navbar-collapse collapse" id="navbarsExample03">
                <ul class="navbar-nav me-auto mb-2 mb-sm-0" id="categoriesContainer">
                    <li class="nav-item bg-primary rounded active">

                        <div class="dropdown">
                            <a class=" nav-link text-white  mx-2" href="#" role="button" id="dropdownMenuLink"
                                data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fa-solid fa-list-ul"></i>
                                All Notes </a>

                        </div>
                    </li>
                    <li class="nav-item  mx-2 ">
                        <a class="nav-link   catagoryClass" href="#" data-evs-cid="1"><i
                                class="fa-solid fa-briefcase"></i>
                            Personal</a>
                    </li>
                    <li class="nav-item mx-2">
                        <a class="nav-link  catagoryClass" href="#" data-evs-cid="2"> <i
                                class="fa fa-share-nodes lg"></i>
                            Private</a>
                    </li>
                    <li class="nav-item mx-2">
                        <a class="nav-link  catagoryClass" href="#" data-evs-cid="3"> <i class="fa-regular fa-star"></i>
                            Public</a>
                    </li>
                    <li class="nav-item mx-2">
                        <a class="nav-link" href="#" id="favourite"> <i class="fa-regular fa-star"></i>
                            faviorate</a>
                    </li>
                </ul>

            </div>
            <form role="search">
                <button id="Addbtn" class="btn btn-primary btn-lg" type="button"> <i class="fa fa-circle-plus"></i>
                    Add New</button>
            </form>
        </div>
    </nav>


    <!-- Add Modal  -->
    <div class="modal fade" id="AddModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false" role="dialog"
        aria-labelledby="modalTitleId" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="modalTitleId">Add New Tasks</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="input-group mb-3">
                        <span class="input-group-text"><i class="fa-regular fa-star"></i></span>
                        <input id="addtxttitle" type="text" min="0" step="1" class="form-control" placeholder="Name" />
                    </div>

                    <div class="input-group mb-3">
                        <span class="input-group-text"><i class="fa-solid fa-signature"></i></span>
                        <textarea id="addtxtDetail" class="form-control" type="text" cols="100" rows="3"
                            placeholder="Details..."></textarea>
                    </div>
                    <div class="input-group mb-3">
                        <span class="input-group-text"><i class="fa fa-address-book"></i></span>
                        <select id="ddlprogress" class="form-control">
                        </select>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="btnResult">Add</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false"
        role="dialog" aria-labelledby="modalTitleId" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="modalTitleId">Delete Tasks</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input id="delhdnid" type="hidden" value="" />
                    <div class="input-group mb-3">
                        <span class="input-group-text"><i class="fa-regular fa-star"></i></span>
                        <input id="deltxttitle" type="text" min="0" step="1" class="form-control" placeholder="Name" />
                    </div>

                    <div class="input-group mb-3">
                        <span class="input-group-text"><i class="fa-solid fa-signature"></i></span>
                        <textarea id="deltxtDetail" class="form-control" type="text" cols="100" rows="3"
                            placeholder="Details..."></textarea>
                    </div>
                    <div class="input-group mb-3">
                        <span class="input-group-text"><i class="fa fa-address-book"></i></span>
                        <select id="delprogress" class="form-control">
                        </select>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="btndelete">Delete</button>
                </div>
            </div>
        </div>
    </div>



    <!-- Show Modal -->
    <div class="modal fade" id="ShowModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false"
        role="dialog" aria-labelledby="modalTitleId" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="modalTitleId">Show Tasks</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input id="showhdnid" type="hidden" value="" />
                    <div class="input-group mb-3">
                        <span class="input-group-text"><i class="fa-regular fa-star"></i></span>
                        <input id="showtxttitle" type="text" min="0" step="1" class="form-control" placeholder="Name" />
                    </div>

                    <div class="input-group mb-3">
                        <span class="input-group-text"><i class="fa-solid fa-signature"></i></span>
                        <textarea id="showtxtDetail" class="form-control" type="text" cols="100" rows="3"
                            placeholder="Details..."></textarea>
                    </div>
                    <div class="input-group mb-3">
                        <span class="input-group-text"><i class="fa fa-address-book"></i></span>
                        <select id="showprogress" class="form-control">
                        </select>
                    </div>

                </div>
                <div class="modal-footer">
                    <!-- <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button> -->
                    <button type="button" class="btn btn-primary" id="btnshow">OK</button>
                </div>
            </div>
        </div>
    </div>



    <!-- Card -->
    <div class="container-fluid popup" id="tbalerw">
        <div class="row">
            <div class="">
                <div class="">
                    <div class="card-body ">
                        <div class="row" id="tblbody">

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- javascript -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
        integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
        integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
        crossorigin="anonymous"></script>
    <script src="js/classess.js"></script>
    <!-- <script src="js/business.js"></script> -->



    <script>



        const showModal = new bootstrap.Modal(document.getElementById("AddModal"));
        const deleteModal = new bootstrap.Modal(document.getElementById("deleteModal"));
        const shModal = new bootstrap.Modal(document.getElementById("ShowModal"));


        const handler = new Datahandler();
        let category = handler.GetCategories();

        let tasks = handler.GetRecord();
        LoadCards(tasks);

        let catagories = document.querySelectorAll(".catagoryClass");
        catagories.forEach((e) => {
            e.addEventListener("click", function (event) {
                event.preventDefault();
                const cid = event.target.getAttribute("data-evs-cid");
                let data = handler.findbycategory(cid);
                // let tasks = handler.GetRecord();

                LoadCards(data);
            });
        });
        document.getElementById("dropdownMenuLink").addEventListener("click", () => {
            let tasks = handler.GetRecord();
            LoadCards(tasks);
            favFun();
        });

        document.getElementById("Addbtn").addEventListener("click", function () {
            // debugger
            let addtitle = document.getElementById("addtxttitle");
            let adddetail = document.getElementById("addtxtDetail");
            let progressid = document.getElementById("ddlprogress");
            // handler.AddTasks(addtitle, new Date(), adddetail, progressid)
            progressid.value = 0;
            addtitle.value = adddetail.value = "";

            showModal.show();
        });

        document.getElementById("btnResult").addEventListener("click", function () {
            // debugger
            let addtitle = document.getElementById("addtxttitle").value;
            let adddetail = document.getElementById("addtxtDetail").value;
            let progressid = document.getElementById("ddlprogress").value;
            handler.AddTasks(addtitle, new Date(), adddetail, progressid);

            LoadCards(handler.GetRecord());
            showModal.hide();
        });

        function LoadCards(tasks) {
            document.getElementById("tblbody").innerHTML = "";
            for (let i = 0; i < tasks.length; i++) {
                let temp = `
        <div class=" col-md-6 col-lg-4">
          <div class="card mt-4">
            <div class="m-4" >
                  <h3 class="mb-0"><a href="#" class="link-show text-decoration-none text-dark" data-vs-pd="${tasks[i].Title},${tasks[i].Detail},${tasks[i].Category.Id}">  ${tasks[i].Title}</a></h3>
                  <div class=" text-body-secondary">${tasks[i].PostedOn}</div>
                </div>

              <div class="card-body">
                  <div class="col  d-flex flex-column position-static">
                      <p class="card-text mb-auto">${tasks[i].Detail}</p>
                      <div class="d-flex mt-lg-5 ">

                              <i class="fa-regular fa-star fa-lg text-primary favourite" id="${tasks[i].Id}"></i>
                          &nbsp;&nbsp;&nbsp;

                              <i class="fa-regular fa-trash-can fa-lg text-danger delete-Card" id="${tasks[i].Id}" ></i>

                      </div>
                  </div>
              </div>
          </div>
        </div>`;
                document.getElementById("tblbody").innerHTML += temp;
            }

            document.querySelectorAll(".delete-Card").forEach((icon) => {
                icon.addEventListener("click", function (e) {
                    // body
                    const pid = e.target.getAttribute("id");
                    // console.log(pid);
                    const found = handler.FindProducts(pid);
                    // console.log(found);
                    if (found) {
                        document.getElementById("delhdnid").value = found.Id;
                        document.getElementById("deltxttitle").value = found.Title;
                        document.getElementById("deltxtDetail").value = found.Detail;
                        document.getElementById("delprogress").value = found.Category.Id;

                        deleteModal.show();
                    }
                });
            });

            document.querySelectorAll('.link-show').forEach((lnk) => {
                lnk.addEventListener('click', function (e) {
                    // body
                    e.preventDefault();
                    const pid = lnk.getAttribute("data-vs-pd");
                    console.log(pid);
                    const values = pid.split(",");
                    const title = values[0];
                    const detail = values[1];
                    const Progress = values[2];

                    let titleInput = document.getElementById('showtxttitle');
                    let detailInput = document.getElementById('showtxtDetail');
                    let progressInput = document.getElementById('showprogress');

                    titleInput.value = title;
                    detailInput.value = detail;
                    progressInput.value = Progress;
                    shModal.show();
                });
            });
        }

        document.getElementById('btnshow').addEventListener('click', function (e) {
            shModal.hide();
        });


        document.getElementById("btndelete").addEventListener("click", function () {
            // body
            const delid = document.getElementById("delhdnid").value;
            const deltitle = document.getElementById("deltxttitle").value;
            const deldetail = document.getElementById("deltxtDetail").value;
            const delprogress = document.getElementById("delprogress").value;
            handler.DeleteTasks(delid, deltitle, deldetail, delprogress);
            LoadCards(handler.GetRecord());
            deleteModal.hide();

        });

        // Favourite
        function favFun(params) {
            let fav = document.querySelectorAll(".favourite");
            fav.forEach((e) => {
                e.addEventListener("click", () => {
                    // console.log(e.getAttribute("id"));
                    handler.setFavourite(e.getAttribute("id"));
                });
            });
        }

        document.getElementById("favourite").addEventListener("click", (e) => {
            let tasks = handler.getFavourite();
            // console.log(tasks);
            LoadCards(tasks);
        });

        // load Categories
        addEventListener("load", function () {
            document.getElementById(
                "ddlprogress"
            ).innerHTML = `<option value="0">Category</option>`;
            for (let i = 0; i < category.length; i++) {
                let temp = `<option value="${category[i].Id}">${category[i].Name}</option>`;
                document.getElementById("ddlprogress").innerHTML += temp;
            }
        });

        addEventListener("load", function () {
            document.getElementById("delprogress").innerHTML = `<option value="0">Category</option>`;
            for (let i = 0; i < category.length; i++) {
                let temp = `<option value="${category[i].Id}">${category[i].Name}</option>`;
                document.getElementById("delprogress").innerHTML += temp;
            }
        });

        addEventListener("load", function () {
            document.getElementById("showprogress").innerHTML = `<option value="0">Category</option>`;
            for (let i = 0; i < category.length; i++) {
                let temp = `<option value="${category[i].Id}">${category[i].Name}</option>`;
                document.getElementById("showprogress").innerHTML += temp;
            }
        });

        favFun();













    </script>


</body>

</html>